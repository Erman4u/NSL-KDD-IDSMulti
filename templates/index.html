<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Intrusion Detection Prediction NSL-KDD</title>
    <!-- Pastikan elemen h2 ini berada di dalam body atau div yang sesuai,
         atau jika Anda ingin ini ada di head, pastikan Anda mengerti implikasinya
         (biasanya konten visual ada di dalam body) -->
    <h2 class="text-xl font-semibold">Erman Saputra - 21.11.3859</h2>

    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">
    <div class="max-w-4xl mx-auto mt-10 p-6 bg-white rounded-2xl shadow-lg">
        <h1 class="text-2xl font-bold mb-4 text-center">Intrusion Detection System</h1>

        <form method="POST" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {% for field in [
                'duration', 'protocol_type', 'service', 'flag', 'src_bytes', 'logged_in', 'root_shell', 'su_attempted', 'num_file_creations', 'num_access_files', 'is_guest_login', 'count', 'srv_count', 'serror_rate', 'srv_serror_rate', 'rerror_rate', 'srv_rerror_rate', 'same_srv_rate', 'diff_srv_rate', 'srv_diff_host_rate', 'dst_host_count', 'dst_host_srv_count', 'dst_host_same_srv_rate', 'dst_host_diff_srv_rate', 'dst_host_same_src_port_rate', 'dst_host_srv_diff_host_rate', 'dst_host_serror_rate', 'dst_host_srv_serror_rate', 'dst_host_rerror_rate', 'dst_host_srv_rerror_rate'
            ] %}
            <div>
                <label class="block text-sm font-semibold capitalize mb-1">{{ field.replace('_', ' ') }}</label>

                {# PERBAIKAN UTAMA: Perbaiki sintaks if/elif/else Jinja2 dan daftar string #}
                {% if field == 'protocol_type' %}
                <select name="{{ field }}" required class="w-full px-3 py-2 border border-gray-300 rounded-xl">
                    <option value="tcp">tcp</option>
                    <option value="udp">udp</option>
                    <option value="icmp">icmp</option>
                </select>
                {% elif field == 'flag' %}
                <select name="{{ field }}" required class="w-full px-3 py-2 border border-gray-300 rounded-xl">
                    <option value="SH">SH</option>
                    <option value="SF">SF</option>
                    <option value="S3">S3</option>
                    <option value="S2">S2</option>
                    <option value="S1">S1</option>
                    <option value="S0">S0</option>
                    <option value="RSTR">RSTR</option>
                    <option value="RSTOSO">RSTOSO</option>
                    <option value="RSTO">RSTO</option>
                    <option value="REJ">REJ</option>
                    <option value="OTH">OTH</option>
                </select>
                {% elif field == 'service' %}
                <select name="{{ field }}" required class="w-full px-3 py-2 border border-gray-300 rounded-xl">
                    {# DAFTAR PROTOKOL SESUAI GAMBAR DARI PERCAKAPAN SEBELUMNYA #}
                    <option value="whois">whois</option>
                    <option value="uucp_path">uucp_path</option>
                    <option value="uuurp">uuurp</option>
                    <option value="urp_i">urp_i</option>
                    <option value="urh_i">urh_i</option>
                    <option value="time">time</option>
                    <option value="tim_i">tim_i</option>
                    <option value="tftp_u">tftp_u</option>
                    <option value="telnet">telnet</option>
                    <option value="systat">systat</option>
                    <option value="supdup">supdup</option>
                    <option value="sunrpc">sunrpc</option>
                    <option value="ssh">ssh</option>
                    <option value="sql_net">sql_net</option>
                    <option value="smtp">smtp</option>
                    <option value="smtpi">smtpi</option>
                    <option value="shell">shell</option>
                    <option value="remote_job">remote_job</option>
                    <option value="red_i">red_i</option>
                    <option value="private">private</option>
                    <option value="print_srv">print_srv</option>
                    <option value="pop_3">pop_3</option>
                    <option value="pop_2">pop_2</option>
                    <option value="pm_udp">pm_udp</option>
                    <option value="other">other</option>
                    <option value="ntp_u">ntp_u</option>
                    <option value="netstat">netstat</option>
                    <option value="netbios_ns">netbios_ns</option>
                    <option value="netbios_dgm">netbios_dgm</option>
                    <option value="netbios_ssn">netbios_ssn</option>
                    <option value="netmbe">netmbe</option>
                    <option value="mtp">mtp</option>
                    <option value="login">login</option>
                    <option value="link">link</option>
                    <option value="ldap">ldap</option>
                    <option value="klogin">klogin</option>
                    <option value="kshell">kshell</option>
                    <option value="iso_tsap">iso_tsap</option>
                    <option value="IRC">IRC</option>
                    <option value="http_8001">http_8001</option>
                    <option value="http_443">http_443</option>
                    <option value="http_2784">http_2784</option>
                    <option value="http">http</option>
                    <option value="hostname">hostname</option>
                    <option value="hostnames">hostnames</option>
                    <option value="gopher">gopher</option>
                    <option value="ftp_data">ftp_data</option>
                    <option value="ftp">ftp</option>
                    <option value="finger">finger</option>
                    <option value="exec">exec</option>
                    <option value="efs">efs</option>
                    <option value="eco_i">eco_i</option>
                    <option value="echo">echo</option>
                    <option value="domain_u">domain_u</option>
                    <option value="domain">domain</option>
                    <option value="discard">discard</option>
                    <option value="daytime">daytime</option>
                    <option value="ctf">ctf</option>
                    <option value="csnet_ns">csnet_ns</option>
                    <option value="courier">courier</option>
                    <option value="bgp">bgp</option>
                    <option value="auth">auth</option>
                    <option value="aol">aol</option>
                    <option value="Z39_50">Z39_50</option>
                    <option value="X11">X11</option>
                </select>
                {% else %}
                {# Ini adalah input numerik untuk semua field lain #}
                <input name="{{ field }}" type="number" step="any" required class="w-full px-3 py-2 border border-gray-300 rounded-xl">
                {% endif %}
            </div>
            {% endfor %}

            <div class="col-span-full text-center mt-4">
                <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-xl hover:bg-blue-700">Predict</button>
            </div>
        </form>

        {% if result %}
        <div class="mt-6 p-4 rounded-xl text-center
                            {{ 'bg-red-100 border border-red-300 text-red-800' if result.prediction == 1 else 'bg-green-100 border border-green-300 text-green-800' }}">
            <h2 class="text-xl font-semibold">Prediction Result</h2>
            <p class="text-2xl font-bold mt-2">
                {{ '⚠️ Attack Detected' if result.prediction == 1 else '✅ Normal Traffic' }}
            </p>
            <p class="mt-2 text-sm text-gray-600">Probability of Attack: {{ result.probability }}</p>
            {# Tampilkan pesan error jika ada #}
            {% if result.message %}
            <p class="mt-2 text-red-600 text-sm">Error: {{ result.message }}</p>
            {% endif %}
        </div>
        {% endif %}
    </div>
</body>
</html>
